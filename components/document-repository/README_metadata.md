# Metadata Strategy

## Two-Step Metadata Extraction

Extract metadata at **upload time** and **ingest time**, allowing for quick user access and later semantic enrichment.

### Metadata List & Default Values (at upload time stoed in ArangoDB)

Extracted *immediately after upload* and stored **in ArangoDB document-repository database, files collection**, to support browsing/searching even before ingest.

* `file_id` (unique identifier)
* `file_name` ğŸ” âœï¸ (e.g. `abc123.pdf`. If the file is a webpage, the user can edit to use the content title as the name.)
* `file_size`
* `file_type` ğŸ” (MIME type)
* `file_hash` (SHA256 hash of the file, for integrity check)
* `storage_path` (local relevant path, e.g. `/uploads/abc123.pdf`)
* `labels` ğŸ” âœï¸ (No labels at the beginning, but users can add/edit labels before ingest.)
* `author` ğŸ” âœï¸
* `upload_date` ğŸ” (timestamp of uploading to the document repository)
* `create_date` ğŸ” âœï¸ (if extractable from file or user-provided. For example, a PDF created at 2023-10-01T12:00:00Z; a html webpage published at 2023-10-01T12:00:00Z)
* `crawl_date` âœï¸ (if applicable, when the file was crawled)
* `source_url` âœï¸ (only if the file is a webpage, e.g. `https://example.com/page`)
* `language` ğŸ” âœï¸ (set as `unknown` at this stage, to be detected later)
* `chunk_count` (number of text chunks. Set to `0` at this stage, to be updated later)
* dataprep
    * `status` ğŸ” (initially set to `pending`, updated to `ingested` after successful ingestion, or `retracted` if the file is retracted)
    * `ingest_date` (timestamp of when the file was successfully ingested, initially empty)
    * `retract_date` (timestamp of when the file was retracted, initially empty)

ğŸ” means the user can search by this metadata field;

âœï¸ means the user can edit this metadata field.

### Enriching Metadata (at ingest time stored in ArangoDB)

Edited/Extracted only **after ingestion/retraction**, using text processing, embedding, or semantic enrichment inside `dataprep-microservice`.

* `language` (If it's `unknown`, detect it using LLM or language detection library)
* `chunk_count` (set it after chunking the document)
* `labels` (If empty, auto-generated by LLM)
* `ingest_date` (set to current timestamp when the file is successfully ingested)
* `retract_date` (set to current timestamp when the file is retracted)
* `status` (updated to `ingested` after successful ingestion, or `retracted` if the file is retracted)

### Example Metadata Records

```json
{
    "file_id": "9527",
    "file_name": "TBHDQX.pdf",
    "file_size": "1.2MB",
    "file_type": "application/pdf",
    "storage_path": "/uploads/TBHDQX.pdf",
    "labels": ["Arts & Culture", "K-12 Education"],
    "author": "Stephen Chow",
    "upload_date": "2025-05-11T10:30:00Z",
    "create_date": "1993-07-01T12:00:00Z",
    "crawl_date": "",
    "source_url": "",
    "language": "zh",
    "chunk_count": 10
}
```

---

## Notes

* Users can **search files by metadata** such as file name, type, and labels **at any time**.
* Users can **edit metadata** fields like `file_name`, `labels`, and `author` **at any time**.
* For labelling, if the user does not provide labels, the system can use LLM to auto-generate relevant labels based on the file content when the file is ingested. However, if the user deletes all labels, the system will not auto-generate new labels unless the user retracts the file and re-ingests it.